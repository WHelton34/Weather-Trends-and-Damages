import pandas as pd

# Load the CSV file
df = pd.read_csv('https://www.ncdc.noaa.gov/stormevents/csv?eventType=ALL&beginDate_mm=01&beginDate_dd=01&beginDate_yyyy=2010&endDate_mm=12&endDate_dd=31&endDate_yyyy=2024&county=MAGOFFIN%3A153&hailfilter=0.00&tornfilter=0&windfilter=000&sort=DT&submitbutton=Search&statefips=21%2CKENTUCKY')

# Select relevant columns
relevant_columns = ['BEGIN_DATE', 'CZ_NAME_STR', 'BEGIN_LOCATION', 'EVENT_TYPE', 'DEATHS_DIRECT', 'DAMAGE_PROPERTY_NUM', 'DAMAGE_CROPS_NUM']
cleaned_df = df[relevant_columns]

# Rename columns
cleaned_df.rename(columns={
    'BEGIN_DATE': 'Date',
    'CZ_NAME_STR': 'CountyName',
    'BEGIN_LOCATION': 'Location',
    'EVENT_TYPE': 'EventType',
    'DEATHS_DIRECT': 'Deaths',
    'DAMAGE_PROPERTY_NUM': 'PropertyDamage',
    'DAMAGE_CROPS_NUM': 'CropDamage'
}, inplace=True)

# Handle missing values
cleaned_df.fillna({'Location': 'Unknown', 'Deaths': 0, 'PropertyDamage': 0, 'CropDamage': 0}, inplace=True)

# Ensure correct data types
cleaned_df['Date'] = pd.to_datetime(cleaned_df['Date'])
cleaned_df['Deaths'] = cleaned_df['Deaths'].astype(int)
cleaned_df['PropertyDamage'] = cleaned_df['PropertyDamage'].astype(float)
cleaned_df['CropDamage'] = cleaned_df['CropDamage'].astype(float)

# Save the cleaned data
cleaned_df.to_csv('cleaned_data_for_tableau.csv', index=False)